# OneDrive 云盘 Web 应用

本文档介绍如何使用基于 OneDrive Storage Middleware 构建的云盘 Web 应用程序。

## 功能概览

云盘 Web 应用提供了一个直观的文件管理界面，主要功能包括：

- ☁️ **存储桶管理** - 创建和管理存储桶
- 📁 **文件浏览** - 可视化的文件和文件夹导航
- 📤 **文件上传** - 支持拖拽上传和多文件上传
- 📥 **文件下载** - 点击下载文件
- 📂 **文件夹操作** - 创建、删除、移动、复制文件夹
- 📄 **文件操作** - 删除、移动、复制、重命名文件
- 🔍 **批量操作** - 多选文件进行批量操作

## 快速开始

### 1. 启动服务器

确保已按照 [quickstart.md](quickstart.md) 中的说明设置了环境：

```bash
# 设置数据库密码
export DB_PASSWORD=your_password

# 启动服务器
make run
```

### 2. 访问 Web 应用

在浏览器中打开：

```
http://localhost:8080/
```

## 界面介绍

### 顶部工具栏

- **新建文件夹** - 在当前目录创建新文件夹
- **上传文件** - 选择文件上传到当前目录

### 左侧边栏

- **存储桶列表** - 显示所有存储桶，点击切换
- **创建存储桶** - 创建新的存储桶

### 主内容区

- **面包屑导航** - 显示当前路径，点击可快速导航
- **文件/文件夹列表** - 显示当前目录下的所有文件和文件夹

### 文件操作

#### 选择文件
- 单击选择单个文件
- Ctrl/Cmd + 单击多选
- 选中后可使用工具栏的批量操作按钮

#### 打开文件/文件夹
- 双击文件夹进入
- 双击文件下载

#### 右键菜单
右键点击文件或文件夹可以：
- 📥 下载（仅文件）
- ✏️ 重命名
- 📦 移动
- 📋 复制
- 🗑️ 删除

### 快捷键

| 快捷键 | 操作 |
|--------|------|
| `Esc` | 关闭弹窗/取消选择 |
| `Delete` | 删除选中的文件 |

### 拖放上传

可以直接将文件拖放到文件浏览区域进行上传。

## API 接口

Web 应用使用以下 API 接口：

### 存储桶管理

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | `/api/v1/buckets` | 获取存储桶列表 |
| PUT | `/api/v1/buckets/{bucket}` | 创建存储桶 |
| DELETE | `/api/v1/buckets/{bucket}` | 删除存储桶 |

### 虚拟文件系统

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | `/api/v1/vfs/{bucket}/{path}` | 获取文件或列出目录 |
| PUT | `/api/v1/vfs/{bucket}/{path}` | 上传文件 |
| DELETE | `/api/v1/vfs/{bucket}/{path}` | 删除文件或目录 |
| POST | `/api/v1/vfs/{bucket}/_mkdir` | 创建目录 |
| POST | `/api/v1/vfs/{bucket}/_move` | 移动/重命名 |
| POST | `/api/v1/vfs/{bucket}/_copy` | 复制文件 |

## 技术架构

```
┌─────────────────────────────────────────────────────────────────┐
│                     云盘 Web 应用                                │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐     │
│  │   HTML/CSS     │  │   JavaScript   │  │   静态资源     │     │
│  │   界面布局      │  │   交互逻辑      │  │   样式文件     │     │
│  └────────────────┘  └────────────────┘  └────────────────┘     │
│                              │                                   │
│                              ▼                                   │
│                        REST API 调用                             │
│                              │                                   │
└──────────────────────────────┼───────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                 OneDrive Storage Middleware                      │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐     │
│  │   API 网关层    │  │   业务逻辑层    │  │   数据访问层    │     │
│  │   HTTP 路由     │  │   文件服务      │  │   PostgreSQL   │     │
│  └────────────────┘  └────────────────┘  └────────────────┘     │
│                              │                                   │
│                              ▼                                   │
│                        OneDrive 账号池                           │
│                    (实际存储在 OneDrive)                         │
└─────────────────────────────────────────────────────────────────┘
```

## 开发说明

### 静态文件位置

Web 应用的静态文件位于：

```
web/
└── static/
    ├── index.html      # 主页面
    ├── css/
    │   └── style.css   # 样式文件
    └── js/
        └── app.js      # JavaScript 应用逻辑
```

### 修改静态文件

修改静态文件后无需重新构建，刷新浏览器即可看到更改。

### 自定义样式

可以通过修改 `web/static/css/style.css` 来自定义界面样式。

主要的 CSS 变量：

```css
:root {
    --primary-color: #0078d4;    /* 主色调 */
    --danger-color: #d32f2f;      /* 危险操作颜色 */
    --bg-color: #f5f5f5;          /* 背景色 */
    --card-bg: #ffffff;           /* 卡片背景 */
    --border-color: #e0e0e0;      /* 边框颜色 */
}
```

## 常见问题

### Q: 上传文件失败？

A: 请检查：
1. 存储桶是否已选择
2. 文件大小是否超过限制
3. 服务器日志中的错误信息

### Q: 看不到已上传的文件？

A: 尝试刷新页面，或检查当前目录路径是否正确。

### Q: 无法删除非空文件夹？

A: 删除非空文件夹时需要确认递归删除，或者先删除文件夹内的文件。

## 浏览器兼容性

Web 应用支持以下现代浏览器：

- Chrome 70+
- Firefox 65+
- Safari 12+
- Edge 79+

## 未来计划

- [ ] 文件预览功能
- [ ] 文件搜索功能
- [ ] 文件分享功能
- [ ] 用户认证功能
- [ ] 多语言支持
- [ ] 深色模式
